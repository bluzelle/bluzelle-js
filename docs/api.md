# API docs

Read below for detailed documentation on how to use the Bluzelle database.

{% hint style="info" %}
The Bluzelle JavaScript library works with [promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) to model asynchronous behavior. Ensure that dependent calls to the Bluzelle database are within `.then()` blocks or within [asynchronous functions](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function). Also ensure that promises exceptions are caught and handled.
{% endhint %}

{% hint style="info" %}
Keys and values in the Bluzelle database are plain strings to ensure compatibility for all forms of serialization. JavaScript applications will probably want to use `JSON.stringify(obj)` and `JSON.parse(str)` to convert object data to and from string format.
{% endhint %}

## Exports

### version

The bluzelle-js version.

```javascript
const {version} = require('bluzelle');

assert(version === '0.4.472');
```

### 

### bluzelle\({entry, uuid, private\_pem}\)

Configures the address, port, private key, and UUID of the connection. This may be called multiple times to create multiple clients. Bluzelle uses `UUID`'s to identify distinct databases on a single swarm. We recommend using [Version 4 of the universally unique identifier](https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_%28random%29).

The private key is a unique identifier for write permissions. The public key is derivable from the private key in ECDSA, so you don't need to provide it.

```javascript
const {bluzelle} = require('bluzelle');

const api = bluzelle({
    entry: 'ws://1.2.3.4:51010', 
    uuid: '96764e2f-2273-4404-97c0-a05b5e36ea66',
    private_pem: 'MHQCAQEEIF...ZKIy8ejQ=='
});
```

{% hint style="info" %}
You must replace the UUID here with your own UUID or else you will have database conflicts.
{% endhint %}

{% hint style="info" %}
`bluzelle` and `version`are the only exports of the Bluzelle library. The calls below are methods of the object generated by calling `bluzelle`.
{% endhint %}

<table>
  <thead>
    <tr>
      <th style="text-align:left">Argument</th>
      <th style="text-align:left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">ws</td>
      <td style="text-align:left">The WebSocket entry point to connect to. ex. <code>ws://testnet.bluzelle.com:51010</code>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">uuid</td>
      <td style="text-align:left">The universally unique identifier, Version 4 is recommended.</td>
    </tr>
    <tr>
      <td style="text-align:left">private_pem</td>
      <td style="text-align:left">The private key for this user in PEM format.</td>
    </tr>
    <tr>
      <td style="text-align:left">log</td>
      <td style="text-align:left">
        <ul>
          <li>When set to <code>true</code>, logs the request and response messages with <code>console.log</code>.</li>
          <li>When set to a function, logs the request and response messages to that
            function.</li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>## Administrative Functions

### close\(\)

Closes the connection.

```javascript
api.close();
```

Returns nothing. Never fails.



### createDB\(\)

Creates a new database at the given uuid.

```javascript
// promise syntax
api.createDB().then(() => { ... }, error => { ... });

// async/await syntax
await api.createDB();
```

Returns a promise resolving to nothing.

Fails when the database already exists.



### deleteDB\(\)

Deletes the database at the given uuid.

```javascript
// promise syntax
api.deleteDB().then(() => { ... }, error => { ... });

// async/await syntax
await api.deleteDB();
```

Returns a promise resolving to nothing.

Fails when no database exists to delete.



### hasDB\(\)

Queries to see if a database exists at the given uuid.

```javascript
// promise syntax
api.hasDB().then(has => { ... }, error => { ... });

// async/await syntax
const has = await api.hasDB();
```

Returns a promise resolving to a boolean.

Fails when a response is not received.



### publicKey\(\)

Generates a public key from the `private_pem` given in the constructor.

```javascript
const pk = api.publicKey();
```

Returns a string containing the base64 PEM encoding of the public key.

### 

### getWriters\(\)

Gets the owner and writers of the given database. The owner is the public key of the user that created the database. The writers array lists the public keys of users that are allowed to make changes to the database.

```javascript
// promise syntax
api.getWriters().then(permissions => { ... }, error => { ... });

// async/await syntax
const permissions = await api.getWriters();
```

Returns a promise resolving to an object like this:

```javascript
{
    owner: 'MFYwEAY...EpZop6A==',
    writers: [
        'MFYwEAYH...0FEoB==',
        ...
    ]
}
```

Fails when a response is not received or the database does not exist.



### addWriters\(writers\)

Adds writers to the writers list. May only be executed by the owner of the database.

```javascript
// promise syntax
api.addWriters('MFYwEAY...EpZop6A==').then(() => { ... }, error => { ... });

// async/await syntax
await api.addWriters(['MFYwEAY...EpZop6A==', 'MFYwEAYH...0FEoB==']);
```

| Argument | Description |
| :--- | :--- |
| writers | A single public key or an array of public keys to add. |

Returns a promise resolving to nothing.

{% hint style="info" %}
Duplicate writers are not added to the writers list.
{% endhint %}



### deleteWriters\(writers\)

Deletes writers from the writers list. May only be executed by the owner of the database.

```javascript
// promise syntax
api.deleteWriters('MFYwEAY...EpZop6A==').then(() => { ... }, error => { ... });

// async/await syntax
await api.deleteWriters(['MFYwEAY...EpZop6A==', 'MFYwEAYH...0FEoB==']);
```

| Argument | Description |
| :--- | :--- |
| writers | A single public key or an array of public keys to delete. |

Returns a promise resolving to nothing.

## Database Functions

### create\(key, value\)

Create a field in the database.

```javascript
// promise syntax
api.create('mykey', '{ a: 13 }').then(() => { ... }, error => { ... });

// async/await syntax
await api.create('mykey', '{ a: 13 }');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key to create |
| value | The string value to set the key |

Returns a promise resolving to nothing.

Fails when a response is not received from the connection, the key already exists, or invalid value.

Fails when a response is not received.



### read\(key\)

Retrieve the value of a key.

```javascript
// promise syntax
api.read('mykey').then(value => { ... }, error => { ... });

// async/await syntax
const value = await api.read('mykey');
```

| Argument | Description |
| :--- | :--- |
| ws | The key to retrieve |

Returns a promise resolving the string value of the key.

Fails when a response is not received or the key does not exist in the database.



### update\(key, value\)

Update a field in the database.

```javascript
// promise syntax
api.update('mykey', '{ a: 13 }').then(() => { ... }, error => { ... });

// async/await syntax
await api.update('mykey', '{ a: 13 }');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key to update |
| value | The string value to set the key |

Returns a promise resolving to nothing.

Fails when a response is not received from the connection, the key does not exist, or invalid value.



### delete\(key\)

Deletes a field from the database.

```javascript
// promise syntax
api.delete('mykey').then(() => { ... }, error => { ... });

// async/await syntax
await bluzelle.delete('mykey');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key to delete |

Returns a promise resolving to nothing.

Fails when a response is not received from the connection or the key is not in the database.



### has\(key\)

Query to see if a key is in the database.

```javascript
// promise syntax
api.has('mykey').then(hasMyKey => { ... }, error => { ... });

// async/await syntax
const hasMyKey = await api.has('mykey');
```

| Argument | Description |
| :--- | :--- |
| key | The name of the key to query |

Returns a promise resolving to a boolean value - `true` or `false`, representing whether the key is in the database.

Fails when a response is not received from the connection.



### keys\(\)

Retrieve a list of all keys.

```javascript
// promise syntax
api.keys().then(keys => { ... }, error => { ... });

// async/await syntax
const keys = await api.keys();
```

Returns a promise resolving to an array of strings. ex. `["key1", "key2", ...]`.

Fails when a response is not received from the connection.



### size\(\)

Retrieves the size of the database in bytes.

```javascript
// promise syntax
api.size().then(size => { ... }, error => { ... });

// async/await syntax
const size = await api.size();
```

Returns a promise resolving to an integer.

Fails when a response is not received from the connection.



